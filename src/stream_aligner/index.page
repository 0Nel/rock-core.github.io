---
title: Basics
sort_info: 0
---

Stream Aligner Basics
-----------

The Stream Aligner may be used to temporarily align data streams, in order to deal with delay in the data gathering process. 

As an extreme example of a delay in the data gathering, let's say you got an IMU giving you a reading every 10 ms. And the time for transmission of the IMU data to the processing component takes 1ms. As second sensor you got a laser scanner on an slow serial line, giving you a reading every 25ms, and the transmission of the scan takes 20ms. This means, that your scan will arrive at best 20ms after it was taken at your processing component. If one would now not compensate for delay, one would process the wrong IMU reading (the one from the future from the point of the laser scan) together with the laser scan.

To compensate for the delay in the data gathering, the stream aligner itself delays the processing of input data until all data samples of all streams for a certain period of time have arrived. For this to work, the period in which the data samples should arrive must be known.  

Example 
-----------

Let's explain this on an example:

We got three streams IMU, Laser, and Odometry.
IMU has a period of 10ms, meaning every 10 ms we should get an IMU reading.
The Laser scanner provides us data every 25 ms.
The Odometry gives us data every ms.

To fully understand the functionality of the stream aligner we need to look at three cases
The real order of the data looks like this :

<div class="img-left-noborder-notopmargin" markdown="1">
![Data time chart](data_18ms.png)
</div>

Burst, all data at one
-----------

The first case would be, we get a burst of data at time 18. In this case the aligner will replay all data.
So, why is this so ? The answer lies in the periods of the streams. As we know the periods of our sensor data, we know, that we would not get any data before the end of the period. From this we can calculate until when no new data will arrive at a stream :  

We get our laser sample at ms 5.8. This means, as the period of the stream is 25ms we can be sure that no new sample will arrive before ms 30.5. In this case it is 'safe' to replay data from other streams until ms 30.5

The IMU samples is from time 3.4 and 13.4. As the period is 10 ms we also know we will not get any data in this stream until ms 23.4

From the Odometry point of view, it is safe to replay until ms 19. (Last sample from ms 18, period 1 ms)

So every data sample until time 19 can be replayed. As every data sample in this example has a time  smaller than 19 they all get replayed.


One sensor delays
-----------

In a second case we assume that the second IMU reading at ms 13.4 did not arrive.

In this case it would only be safe to replay data until 13.4 thus the rest of the data will be buffered, until the expected IMU reading arrives.


Timeout, one sensor heavily delays
-----------

For the third case we introduce a time constrain for replay.
Let's assume we are doing some obstacle avoidance and need to be sure that we process at least every 100ms any sample. For this case the aligner supports a timeout.

In this example the odometry is providing data every ms and the scanner provides data every 25 ms, but the IMU is delayed heavily by 300ms and the timeout is set to 100ms.  

TODO write me
